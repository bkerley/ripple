<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Ripple: Riak on Rails : A rich Ruby client for Riak, Basho's distributed database" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Ripple: Riak on Rails</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/bkerley/ripple">View on GitHub</a>

          <h1 id="project_title">Ripple: Riak on Rails</h1>
          <h2 id="project_tagline">A rich Ruby client for Riak, Basho's distributed database</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/bkerley/ripple/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/bkerley/ripple/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h1>
<code>ripple</code>: Riak Document Models <a href="http://travis-ci.org/basho/ripple"><img src="https://secure.travis-ci.org/basho/ripple.png" alt="Build Status"></a>
</h1>

<p><code>ripple</code> is a rich Ruby modeling layer for Riak, Basho's distributed
database that contains an ActiveModel-based document abstraction which
is inspired by ActiveRecord, DataMapper, and MongoMapper.</p>

<h2>Dependencies</h2>

<p><code>ripple</code> requires Ruby 1.8.7 or later and versions 3 or above of
ActiveModel and ActiveSupport (and their dependencies, including
i18n). Naturally, it also depends on the <code>riak-client</code> gem to connect
to Riak.</p>

<p>Development dependencies are handled with bundler. Install bundler
(<code>gem install bundler</code>) and run this command in each sub-project to
get started:</p>

<div class="highlight"><pre><span class="nv">$ </span>bundle install
</pre></div>

<p>Run the RSpec suite using <code>bundle exec</code>:</p>

<div class="highlight"><pre><span class="nv">$ </span>bundle <span class="nb">exec </span>rake spec
</pre></div>

<h2>Document Model Examples</h2>

<div class="highlight"><pre><span class="nb">require</span> <span class="s1">'ripple'</span>

<span class="c1"># Documents are stored as JSON objects in Riak but have rich</span>
<span class="c1"># semantics, including validations and associations.</span>
<span class="k">class</span> <span class="nc">Email</span>
  <span class="kp">include</span> <span class="ss">Ripple</span><span class="p">:</span><span class="ss">:Document</span>
  <span class="n">property</span> <span class="ss">:from</span><span class="p">,</span>    <span class="nb">String</span><span class="p">,</span> <span class="ss">:presence</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">property</span> <span class="ss">:to</span><span class="p">,</span>      <span class="nb">String</span><span class="p">,</span> <span class="ss">:presence</span> <span class="o">=&gt;</span> <span class="kp">true</span>
  <span class="n">property</span> <span class="ss">:sent</span><span class="p">,</span>    <span class="no">Time</span><span class="p">,</span>   <span class="ss">:default</span> <span class="o">=&gt;</span> <span class="nb">proc</span> <span class="p">{</span> <span class="no">Time</span><span class="o">.</span><span class="n">now</span> <span class="p">}</span>
  <span class="n">property</span> <span class="ss">:body</span><span class="p">,</span>    <span class="nb">String</span>
<span class="k">end</span>

<span class="n">email</span> <span class="o">=</span> <span class="no">Email</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"37458abc752f8413e"</span><span class="p">)</span>  <span class="c1"># GET /riak/emails/37458abc752f8413e</span>
<span class="n">email</span><span class="o">.</span><span class="n">from</span> <span class="o">=</span> <span class="s2">"someone@nowhere.net"</span>
<span class="n">email</span><span class="o">.</span><span class="n">save</span>                               <span class="c1"># PUT /riak/emails/37458abc752f8413e</span>

<span class="n">reply</span> <span class="o">=</span> <span class="no">Email</span><span class="o">.</span><span class="n">new</span>
<span class="n">reply</span><span class="o">.</span><span class="n">from</span> <span class="o">=</span> <span class="s2">"justin@bashoooo.com"</span>
<span class="n">reply</span><span class="o">.</span><span class="n">to</span>   <span class="o">=</span> <span class="s2">"sean@geeemail.com"</span>
<span class="n">reply</span><span class="o">.</span><span class="n">body</span> <span class="o">=</span> <span class="s2">"Riak is a good fit for scalable Ruby apps."</span>
<span class="n">reply</span><span class="o">.</span><span class="n">save</span>                               <span class="c1"># POST /riak/emails (Riak-assigned key)</span>

<span class="c1"># Documents can contain embedded documents, and link to other standalone documents </span>
<span class="c1"># via associations using the many and one class methods.</span>
<span class="k">class</span> <span class="nc">Person</span>
  <span class="kp">include</span> <span class="ss">Ripple</span><span class="p">:</span><span class="ss">:Document</span>
  <span class="n">property</span> <span class="ss">:name</span><span class="p">,</span> <span class="nb">String</span>
  <span class="n">many</span> <span class="ss">:addresses</span>
  <span class="n">many</span> <span class="ss">:friends</span><span class="p">,</span> <span class="ss">:class_name</span> <span class="o">=&gt;</span> <span class="s2">"Person"</span>
  <span class="n">one</span> <span class="ss">:account</span>
<span class="k">end</span>

<span class="c1"># Account and Address are embeddable documents</span>
<span class="k">class</span> <span class="nc">Account</span>
  <span class="kp">include</span> <span class="ss">Ripple</span><span class="p">:</span><span class="ss">:EmbeddedDocument</span>
  <span class="n">property</span> <span class="ss">:paid_until</span><span class="p">,</span> <span class="no">Time</span>
  <span class="n">embedded_in</span> <span class="ss">:person</span> <span class="c1"># Adds "person" method to get parent document</span>
<span class="k">end</span>

<span class="k">class</span> <span class="nc">Address</span>
  <span class="kp">include</span> <span class="ss">Ripple</span><span class="p">:</span><span class="ss">:EmbeddedDocument</span>
  <span class="n">property</span> <span class="ss">:street</span><span class="p">,</span> <span class="nb">String</span>
  <span class="n">property</span> <span class="ss">:city</span><span class="p">,</span> <span class="nb">String</span>
  <span class="n">property</span> <span class="ss">:state</span><span class="p">,</span> <span class="nb">String</span>
  <span class="n">property</span> <span class="ss">:zip</span><span class="p">,</span> <span class="nb">String</span>
<span class="k">end</span>

<span class="n">person</span> <span class="o">=</span> <span class="no">Person</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"adamhunter"</span><span class="p">)</span>
<span class="n">person</span><span class="o">.</span><span class="n">friends</span> <span class="o">&lt;&lt;</span> <span class="no">Person</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">"seancribbs"</span><span class="p">)</span> <span class="c1"># Links to people/seancribbs with tag "friend"</span>
<span class="n">person</span><span class="o">.</span><span class="n">addresses</span> <span class="o">&lt;&lt;</span> <span class="no">Address</span><span class="o">.</span><span class="n">new</span><span class="p">(</span><span class="ss">:street</span> <span class="o">=&gt;</span> <span class="s2">"100 Main Street"</span><span class="p">)</span> <span class="c1"># Adds an embedded address</span>
<span class="n">person</span><span class="o">.</span><span class="n">account</span><span class="o">.</span><span class="n">paid_until</span> <span class="o">=</span> <span class="mi">3</span><span class="o">.</span><span class="n">months</span><span class="o">.</span><span class="n">from_now</span>
</pre></div>

<h2>Configuration Example</h2>

<p>When using Ripple with Rails 3, add ripple to your Gemfile and then run the <code>ripple</code> generator.  This will generate a test harness, some MapReduce functions and a configuration file. Example:</p>

<pre><code>$ rails g ripple
      create  config/ripple.yml
      create  app/mapreduce
      create  app/mapreduce/contrib.js
      create  app/mapreduce/ripple.js
      create  test/ripple_test_helper.rb
      insert  test/test_helper.rb
      insert  test/test_helper.rb
</code></pre>

<p><code>config/ripple.yml</code> should contain your Riak connection information, and settings for the test server. Example:</p>

<div class="highlight"><pre><span class="c1"># Configure Riak connections for the Ripple library.</span>
<span class="l-Scalar-Plain">development</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">http_port</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">8098</span>
  <span class="l-Scalar-Plain">pb_port</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">8087</span>
  <span class="l-Scalar-Plain">host</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">127.0.0.1</span>

<span class="c1"># The test environment has additional keys for configuring the</span>
<span class="c1"># Riak::TestServer for your test/spec suite:</span>
<span class="c1">#</span>
<span class="c1"># * bin_dir specifies the path to the "riak" script that you use to</span>
<span class="c1">#           start Riak (just the directory)</span>
<span class="c1"># * js_source_dir specifies where your custom Javascript functions for</span>
<span class="c1">#           MapReduce should be loaded from. Usually app/mapreduce.</span>
<span class="l-Scalar-Plain">test</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">http_port</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">9000</span>
  <span class="l-Scalar-Plain">pb_port</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">9002</span>
  <span class="l-Scalar-Plain">host</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">127.0.0.1</span>
  <span class="l-Scalar-Plain">bin_dir</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">/usr/local/bin</span>   <span class="c1"># Default for Homebrew.</span>
  <span class="l-Scalar-Plain">js_source_dir</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">&lt;%%= Rails.root + "app/mapreduce" %&gt;</span>

<span class="l-Scalar-Plain">production</span><span class="p-Indicator">:</span>
  <span class="l-Scalar-Plain">http_port</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">8098</span>
  <span class="l-Scalar-Plain">pb_port</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">8087</span>
  <span class="l-Scalar-Plain">host</span><span class="p-Indicator">:</span> <span class="l-Scalar-Plain">127.0.0.1</span>
</pre></div>

<p><code>require 'ripple/railtie'</code> from your <code>config/application.rb</code> file to complete the integration.</p>

<h2>How to Contribute</h2>

<ul>
<li>
<p>Fork the project on <a href="http://github.com/basho/ripple">Github</a>.  If you have already forked, use <code>git pull --rebase</code> to reapply your changes on top of the mainline. Example:</p>

<div class="highlight"><pre><span class="nv">$ </span>git checkout master
<span class="nv">$ </span>git pull --rebase basho master
</pre></div>
</li>
<li>
<p>Create a topic branch. If you've already created a topic branch, rebase it on top of changes from the mainline "master" branch. Examples:</p>

<ul>
<li>
<p>New branch:</p>

<div class="highlight"><pre><span class="nv">$ </span>git checkout -b topic
</pre></div>
</li>
<li>
<p>Existing branch:</p>

<div class="highlight"><pre><span class="nv">$ </span>git rebase master
</pre></div>
</li>
</ul>
</li>
<li><p>Write an RSpec example or set of examples that demonstrate the necessity and validity of your changes. <strong>Patches without specs will most often be ignored. Just do it, you'll thank me later.</strong> Documentation patches need no specs, of course.</p></li>
<li><p>Make your feature addition or bug fix. Make your specs and stories pass (green).</p></li>
<li><p>Run the suite using multiruby or rvm to ensure cross-version compatibility.</p></li>
<li><p>Cleanup any trailing whitespace in your code (try @whitespace-mode@ in Emacs, or "Remove Trailing Spaces in Document" in the "Text" bundle in Textmate).</p></li>
<li><p>Commit, do not mess with Rakefile or VERSION.  If related to an existing issue in the <a href="http://github.com/basho/ripple/issues">tracker</a>, include "Closes #X" in the commit message (where X is the issue number).</p></li>
<li><p>Send me a pull request.</p></li>
</ul><h2>License &amp; Copyright</h2>

<p>Copyright ©2010-2012 Sean Cribbs and Basho Technologies, Inc.</p>

<p>Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at</p>

<p><a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></p>

<p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License.</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Ripple: Riak on Rails maintained by <a href="https://github.com/bkerley">bkerley</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

    

  </body>
</html>
